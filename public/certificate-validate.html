<!doctype html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1">
  <title>Validate Certificate â€” QMSPL</title>
  <script src="https://cdn.tailwindcss.com"></script>
</head>

<body class="bg-slate-50 p-6">

<a href="index.html" class="text-indigo-600">&larr; Back to Home</a>

<h1 class="text-3xl font-bold mt-4">Certificate Validation</h1>
<p class="text-slate-600 mt-2">Enter the details below to verify authenticity.</p>

<div class="bg-white max-w-xl mt-8 p-6 rounded-xl shadow">

  <form id="valForm" onsubmit="return false;">
    <label class="block text-sm font-medium">Certificate ID</label>
    <input id="certificate_id"
           class="border w-full px-3 py-2 rounded mt-1"
           placeholder="CERT-xxxxxx" />

    <label class="block text-sm font-medium mt-4">Date of Issue</label>
    <input id="date_of_issue"
           type="date"
           class="border w-full px-3 py-2 rounded mt-1" />

    <button id="validateBtn"
            class="mt-6 w-full bg-indigo-600 text-white py-2 rounded">
      Validate
    </button>
  </form>

  <div id="result"
       class="mt-4 hidden p-4 rounded text-sm"></div>
</div>


<script>
document.getElementById("validateBtn").addEventListener("click", async () => {
  const id = document.getElementById("certificate_id").value.trim();
  const date = document.getElementById("date_of_issue").value;

  const result = document.getElementById("result");
  result.classList.add("hidden");

  if (!id || !date) {
    show("red", "Please fill all fields.");
    return;
  }

  try {
    const res = await fetch("/api/validate", {
      method: "POST",
      headers: {"Content-Type": "application/json"},
      body: JSON.stringify({ certificate_id: id, date_of_issue: date })
    });

    const data = await res.json();

    if (res.ok) {
      show("green",
      `<b>${data.company_name}</b><br>
       Date of Issue: ${data.date_of_issue}<br>
       Surveillance 1: ${data.surveillance_1}<br>
       Surveillance 2: ${data.surveillance_2}`);
    } else {
      show("red", data.error);
    }

  } catch (err) {
    show("red", "Server error or network issue.");
  }
});

function show(color, msg) {
  const result = document.getElementById("result");
  result.classList.remove("hidden");
  result.style.background = color === "red" ? "#fee2e2" : "#dcfce7";
  result.innerHTML = msg;
}
</script>

</body>
</html>
